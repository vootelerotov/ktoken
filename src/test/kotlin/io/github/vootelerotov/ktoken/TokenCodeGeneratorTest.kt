package io.github.vootelerotov.ktoken

import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Nested
import org.junit.jupiter.params.ParameterizedTest
import org.junit.jupiter.params.provider.CsvSource
import java.time.Instant

class TokenCodeGeneratorTest {

  @Nested
  inner class TokenCodeGeneratorFromTokenStringTest {

    @ParameterizedTest
    @CsvSource(
      "262511375212421201627245761530122205165042430017471044364150151312743332716776027, 2021-10-06T23:12:06Z, 969978",
      "262511375212421201627245761530122205165042430017471044364150151312743332716776027, 2024-01-07T08:54:55Z, 311054",
      "262511375212421201627245761530122205165042430017471044364150151312743332716776027, 2025-07-12T17:32:27Z, 389677",

      "262511375212470556474402475115642006365202473514016006064150151312565422716703050, 2019-12-03T03:25:45Z, 866992",
      "262511375212470556474402475115642006365202473514016006064150151312565422716703050, 2024-01-26T07:06:27Z, 255506",
      "262511375212470556474402475115642006365202473514016006064150151312565422716703050, 2026-02-27T14:52:00Z, 103296",

      "262511375212473251113041231374527567744422263576163572564150151312007572716701322, 2012-01-01T00:00:00Z, 694185",
      "262511375212473251113041231374527567744422263576163572564150151312007572716701322, 2024-01-26T07:10:58Z, 801643",
      "262511375212473251113041231374527567744422263576163572564150151312007572716701322, 2029-01-03T10:43:14Z, 198029",
    )
    fun testTokenCodeGeneratorFromTokenString(token: String, timestamp: Instant, expectedTokenCode: String) {
      val tokenCodeGenerator = TokenCreator().createTokenCodeGeneratorFromString(token)

      val tokenCode = tokenCodeGenerator.generateTokenCode(timestamp)

      assertThat(tokenCode).isEqualTo(expectedTokenCode)
    }

  }

}
